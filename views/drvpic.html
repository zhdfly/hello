[[template "top.html" .]]
<script type="text/javascript" src="../static/js/layer/layer.js"></script>
<script type="text/javascript" src="../static/js/context/context.js"></script>
<script type="text/javascript" src="../static/js/drag.js"></script>
<script type="text/javascript" src="../static/js/drvpic.js"></script>
<link rel="stylesheet" type="text/css" href="../static/js/context/context.standalone.css">
<style type="text/css">
    #dragroom {
        z-index: -99;
        width: 900px;
        height: 450px;
        padding: 5px;
        position: absolute;
        resize: both;
        overflow: hidden;
        border: 2px dashed #ccc;
        background: #fff;
    }

    .transparent {
        filter: alpha(opacity=0);
        -moz-opacity: 0.8;
        -khtml-opacity: 0.8;
        opacity: 0.8;
    }

    .boxs {
        width: 200px;
        height: 100px;
        cursor: move;
        position: absolute;
        top: 30px;
        left: 30px;
        z-index: 99;
    }

    .boxs .bg {
        width: 100%;
        height: 100%;
        background-color: #26a65b;
    }

    .boxs:hover .coors {
        display: block;
    }
    .boxs:hover .tip {
        display: block;
    }
    .boxs .tip {
        display: none;
        width: 100%;
        padding-top: 5px;
        height: 30px;
        text-align: center;
        position: absolute;
        overflow: hidden;
        left: 0px;
        top: 0px;

        color: #26a65b;
        background-color: rgb(255, 255, 255);
    }
    .boxs .coors {
        display: none;
        width: 5px;
        height: 5px;
        overflow: hidden;
        cursor: se-resize;
        position: absolute;
        border: 1px solid;
        border-radius: 5px;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 0, 0, 0.658);
    }


    .boxs .contentpic {
        position: absolute;

        top: 50%;
        z-index: 99;
        text-align: center;
        font: bold 14px/1.5em simsun;
        color: #000;
    }
</style>
<!-- MAIN -->
<div class="content" id="app">
    <!-- <pre id="debug"></pre> -->

    <a href="#" class="btn btn-default btn-xs" @click="uploadbk">
        <i class="fa fa-picture-o"></i>设置背景</a>
    <a href="#" class="btn btn-default btn-xs" id="btn_add" @click="adddot">
        <i class="fa fa-picture-o"></i>添加数据点</a>
    <a href="#" class="btn btn-default btn-xs" id="btn_addvideo">
        <i class="fa fa-picture-o"></i>添加视频</a>
    <a href="#" class="btn btn-default btn-xs" id="btn_lock">
        <i class="fa fa-picture-o"></i>锁定区域</a>
    <a href="#" class="btn btn-default btn-xs" id="btn_save">
        <i class="fa fa-picture-o"></i>获取数据</a>
    <br>
    <br>
    <div id="dragroom">
        <img :src="bksrc" height="100%" width="100%" />
    </div>
</div>
<script>
    new Vue({
        el: '#app',
        data: {
            bksrc: "",
            drv: [[.drv]],
            ob: []
        },
        created: function () {
            var self = this
            $.post("/web/drvdot",
                {
                    type: "drvdot",
                    drv: self.drv,
                },
                function (data, status) {
                    self.ob = JSON.parse(data)
                    console.log(self.ob);
                });
        },
        methods: {
            uploadbk: function () {
                var self = this
                layer.open({
                    content: '<input class="form-control input-sm" type="text" id="bk" name="image" />',
                    yes: function (index, layero) {
                        self.bksrc = $("#bk").val()
                        layer.close(index);
                    }
                });
            },
            creatnewdotbox: function () {
                var self = this
                console.log($("#dotname").text() + ":" + $("#dotname").val())
                creategd({
                    text: $("#dotname").text() + ":" + $("#dotname").val(),
                    width: 100,
                    height: 100
                });
            },
            adddot: function () {
                var self = this
                var htmlstr = '<select class="form-control input-sm" id="dotnames">'
                for (c in self.ob) {
                    htmlstr += '<option :value="'+self.ob[c].Value + '">' + self.ob[c].Name + '</option>'
                }
                htmlstr += '</select>'
                layer.open({
                    content: htmlstr,
                    yes: function (index, layero) {
                        createBox({
                            text: $("#dotnames").val(),
                            width: 100,
                            height: 100,
                            tip:$("#dotnames").selectedIndex
                        })
                        layer.close(index);
                    }
                });
            },
            ct: function (event) {
                var el = event.target
                console.log(el.x)

            }
        }
    })
    draginit($("#dragroom"))
</script> [[template "bottom.html" .]]