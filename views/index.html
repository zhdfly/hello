[[template "top.html" .]]

<!-- MAIN -->
<div class="content">
	<!-- OVERVIEW -->
	<div id="app">
		<div>
			<div class="panel">
				<div class="panel-heading">
					<h3 class="panel-title">{{ ob.User }}</h3>
					<ul class="panel-tools">
						<li>
							<a class="icon expand-tool">
								<i class="fa fa-expand"></i>
							</a>
						</li>
						<li>
							<a class="icon minimise-tool">
								<i class="fa fa-minus"></i>
							</a>
						</li>
					</ul>
				</div>
				<div class="panel-body">
					<div v-for="v in ob.Drv">
						<br>
						<div class="title pull-bottom" style="border-left: 2px solid #2eb4dd;padding-left: 10px">{{v.Drvname}}</div>
						<br>
						<div class="row">
							<div class="col-md-3 col-sm-4 col-xs-6 col-lg-2" style="margin-top: 10px;height: 150px;" v-for="x in v.Dot">
								<div style="border-bottom: 2px solid #2eb4dd;height: 20%;background-color: #2eb4dd;color: #fff;text-align: center;vertical-align: middle">
									{{x.Dotname}}
								</div>
								<!--数据显示-->
								<div style="border: 1px solid #ccc;height: 60%;">
									<div v-if="x.Dottype==='数值类'" style="padding: 5px;margin-top: 20px">
										<div style="float:left;font-size: 25px;width: 60%;text-align: center">
											{{x.Value}}
										</div>
										<div style="float:left;">
											lg
										</div>
									</div>
									<div v-else>
										<div style="margin-top: 22px;text-align: center">
											<div v-if="x.Value==='1'">
												<input type="checkbox" checked data-toggle="toggle" data-onstyle="success">
											</div>
											<div v-else>
												<input type="checkbox" data-toggle="toggle" data-onstyle="success">
											</div>
										</div>
									</div>
								</div>
								<div style="border: 1px solid #ccc;height: 20%;text-align: right;padding-right: 5px">
									<button type="button" class="btn btn-success btn-xs">设置</a>
										<button type="button" class="btn btn-success btn-xs" data-toggle="modal" data-target="#userdrvs" data-user="123" @click="getvalue(v.Drvname,x.Dotname)">历史</a>
								</div>
							</div>
						</div>
						<div>

						</div>
					</div>
				</div>
			</div>
			<div class="modal fade" id="userdrvs" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">×</span>
							</button>
							<h4 class="modal-title">
								<div id="valuetitle">管理设备</div>
							</h4>
						</div>
						<div class="modal-body">
							<div class="row">
								<div class="col-sm-4">
									起始时间：
									<input type='text' class='form-control selectData' id='datestart' name='date'>
								</div>
								<div class="col-sm-4">
									结束时间：
									<input type='text' class='form-control selectData' id='datestop' name='date'>
								</div>
								<div class="col-sm-4">
									<button type="button" class="btn btn-success" @click="getvalue('S','S')">查询</a>
								</div>
							</div>
							<!-- 为 ECharts 准备一个具备大小（宽高）的 DOM -->
							<div id="main" style="width: 500px;height:400px;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- END OVERVIEW -->
</div>
<script>
	var tmp = JSON.parse([[.tmp]]);
	new Vue({
		el: '#app',
		data: {
			ob: tmp,
			drv: "",
			dot: ""
		},
		methods: {
			getvalue: function (drv, dot) {
				var self = this;
				if (drv == "S" && dot == "S") { }
				else {
					self.drv = drv
					self.dot = dot
				}
				if ($("#datestart").val() == "") {
					var starttime = new Date(new Date().getTime())
					var stoptime = new Date(new Date().getTime() + 24 * 60 * 60 * 1000)
					$("#datestart").val(starttime.getFullYear() + '/' + (starttime.getMonth() + 1) + '/' + starttime.getDate())
					$("#datestop").val(stoptime.getFullYear() + '/' + (stoptime.getMonth() + 1) + '/' + stoptime.getDate())
				}
				$("#valuetitle").text(self.drv + ":" + self.dot + "  历史数据")
				$.post("/admin/",
					{
						type: "dotvalue",
						drv: self.drv,
						dot: self.dot,
						start: $("#datestart").val(),
						stop: $("#datestop").val()
					},
					function (data, status) {
						myChart.setOption({
							xAxis: {
								type: 'category',
								boundaryGap: false,
								data: JSON.parse(data).Time
							},
							series: [{
								// 根据名字对应到相应的系列
								name: dot,
								data: JSON.parse(data).Data
							}]
						});
					});
			},
		}
	})
	//自适应宽高
	var myChart = echarts.init(document.getElementById('main'));
	var myChartContainer = function () {
		document.getElementById('main').style.width = document.getElementById('valuetitle').offsetWidth + 10 + 'px'
	};
	myChartContainer();

	// 显示标题，图例和空的坐标轴
	myChart.setOption({
		xAxis: {
			type: 'category',
			boundaryGap: false,
			data: []
		},
		yAxis: {
			type: 'value',
			data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日']
		},
		tooltip: {
			trigger: 'axis',
		},
		series: [{
			name: '最高气温',
			type: 'line',
			data: [11, 11, 15, 13, 12, 13, 10],
			markPoint: {
				data: [
					{ type: 'max', name: '最大值' },
					{ type: 'min', name: '最小值' }
				]
			},
			markLine: {
				data: [
					{ type: 'average', name: '平均值' }
				]
			}
		}]
	});
	//浏览器大小改变时重置大小
	window.onresize = function () {
		//myChartContainer();
		//myChart.resize();
	};
	$.fn.datepicker.dates['cn'] = {   //切换为中文显示
		days: ["周日", "周一", "周二", "周三", "周四", "周五", "周六", "周日"],
		daysShort: ["日", "一", "二", "三", "四", "五", "六", "七"],
		daysMin: ["日", "一", "二", "三", "四", "五", "六", "七"],
		months: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
		monthsShort: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"],
		today: "今天",
		clear: "清除"
	};

	$('.selectData').datepicker({
		autoclose: true, //自动关闭
		beforeShowDay: $.noop,    //在显示日期之前调用的函数
		calendarWeeks: false,     //是否显示今年是第几周
		clearBtn: false,          //显示清除按钮
		daysOfWeekDisabled: [],   //星期几不可选
		endDate: Infinity,        //日历结束日期
		forceParse: true,         //是否强制转换不符合格式的字符串
		format: 'yyyy-mm-dd',     //日期格式
		keyboardNavigation: true, //是否显示箭头导航
		language: 'cn',           //语言
		minViewMode: 0,
		orientation: "auto",      //方向
		rtl: false,
		startDate: -Infinity,     //日历开始日期
		startView: 0,             //开始显示
		todayBtn: false,          //今天按钮
		todayHighlight: false,    //今天高亮
		weekStart: 0              //星期几是开始
	});

	console.log(tmp)
</script>
<!-- Basic Single Date Picker -->
<script type="text/javascript">
	$('#userdrvs').on('show.bs.modal', function (event) {
		var starttime = new Date(new Date().getTime())
		var stoptime = new Date(new Date().getTime() + 24 * 60 * 60 * 1000)
		$("#datestart").val(starttime.getFullYear() + '/' + (starttime.getMonth() + 1) + '/' + starttime.getDate())
		$("#datestop").val(stoptime.getFullYear() + '/' + (stoptime.getMonth() + 1) + '/' + stoptime.getDate())

	});

</script>
<!-- END MAIN -->